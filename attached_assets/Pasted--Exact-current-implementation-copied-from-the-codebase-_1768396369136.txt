// Exact current implementation copied from the codebase
class BufferPool{constructor(o={}){this.minBufferSize=o.minBufferSize??1024;this.maxBufferSize=o.maxBufferSize??5120;this.maxBuffersPerSize=o.maxBuffersPerSize??20;this.growthFactor=o.growthFactor??1.5;this.maxAllocationSize=o.maxAllocationSize??5120;this.pools=new Map();this.availableBuffers=new Map();this.totalAllocated=0;this.totalReused=0;this.totalCreated=0;this.initializePools();this.stats={allocations:0,reuseOperations:0,creationOperations:0,totalMemoryUsed:0,hitRate:0,currentBuffers:0};}initializePools(){for(let size=this.minBufferSize;size<=this.maxBufferSize;size=Math.ceil(size*this.growthFactor)){this.pools.set(size,[]);this.availableBuffers.set(size,0);}}acquire(requestedSize){this.stats.allocations++;const poolSize=this.findPoolSize(requestedSize),pool=this.pools.get(poolSize);if(pool?.length>0){const buffer=pool.pop(),available=this.availableBuffers.get(poolSize)-1;this.availableBuffers.set(poolSize,Math.max(0,available));this.stats.reuseOperations++;this.updateMemoryUsage(-poolSize);return buffer;}return this.createBuffer(poolSize);}release(buffer){if(!Buffer.isBuffer(buffer))return false;const size=buffer.length,poolSize=this.findPoolSize(size),pool=this.pools.get(poolSize);if(pool?.length<this.maxBuffersPerSize){buffer.fill(0);pool.push(buffer);const available=this.availableBuffers.get(poolSize)+1;this.availableBuffers.set(poolSize,available);this.stats.creationOperations++;this.updateMemoryUsage(poolSize);return true;}return false;}createBuffer(size){if(size>this.maxAllocationSize)throw new Error(`Buffer size ${size} exceeds maximum allocation size ${this.maxAllocationSize}`);try{const buffer=Buffer.alloc(size);this.updateMemoryUsage(size);return buffer;}catch(e){return Buffer.allocUnsafe(size);}}findPoolSize(requestedSize){if(requestedSize>this.maxAllocationSize)throw new Error(`Requested buffer size ${requestedSize} exceeds maximum allocation size ${this.maxAllocationSize}`);let size=this.minBufferSize;while(size<requestedSize&&size<=this.maxBuff...